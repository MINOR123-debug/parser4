import json
import os
from aiogram import Router, F
from aiogram.filters import CommandStart
from aiogram.types import Message, CallbackQuery
from keyboards import search_menu
from aiogram.filters import Command

command_router = Router()

# –®–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É –∑ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
users_file = "users.json"

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É —Ñ–∞–π–ª
def save_user_data(user_id, username, first_name):
    try:
        # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ
        with open("users.json", "r", encoding="utf-8") as f:
            users = json.load(f)
    except FileNotFoundError:
        # –Ø–∫—â–æ —Ñ–∞–π–ª –Ω–µ —ñ—Å–Ω—É—î, —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫
        users = []

    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–∂–µ —î —É —Å–ø–∏—Å–∫—É
    for user in users:
        if user["id"] == user_id:
            return  # –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–∂–µ —î, –Ω–µ –¥–æ–¥–∞—î–º–æ –π–æ–≥–æ –∑–Ω–æ–≤—É

    # –î–æ–¥–∞—î–º–æ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    users.append({
        "id": user_id,
        "username": username,
        "first_name": first_name
    })

    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–∞–Ω—ñ —É —Ñ–∞–π–ª
    with open("users.json", "w", encoding="utf-8") as f:
        json.dump(users, f, ensure_ascii=False, indent=4)

@command_router.message(CommandStart())
async def start_command(message: Message):
    """
    –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start.
    """
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    user_id = message.from_user.id
    username = message.from_user.username
    first_name = message.from_user.first_name
    save_user_data(user_id, username, first_name)

    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
    await message.answer(
        f"–ü—Ä–∏–≤—ñ—Ç, {message.from_user.first_name}! üëã\n"
        "–Ø –¥–æ–ø–æ–º–æ–∂—É —Ç–æ–±—ñ –∑–±—ñ—Ä–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –∑ –∫–∞–Ω–∞–ª—É –≤ —Å–ø–∏—Å–æ–∫ —Ç–µ–ª–µ–≥—Ä–∞–ºüí¨\n"
        "–ø–æ –∫–Ω–æ–ø—Ü—ñ –Ω–∏–∂–µ‚¨áÔ∏è —Ç–∏ –º–æ–∂–µ—à –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è –≤–µ—Å—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ë–æ—Ç–∞üåü\n"
        "\n", reply_markup=search_menu,
    )


@command_router.callback_query(F.data == "info")
async def cmd_info(callback: CallbackQuery):
    await callback.answer('info')
    await callback.message.answer(f"–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ë–æ—Ç–∞ü§ñ \n"
                                  "–±–æ—Ç –≤–º—ñ—î –ø–∞—Ä—Å–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º,\n"
                                  "–±–æ—Ç –∑–±–∏—Ä–∞—î –ª–∏—à–µ –ø—É–±–ª—ñ—á–Ω—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—É—Ç–≤–∞—á–∞ –∑ –∫–∞–Ω–∞–ª—ñ–≤ —Å–∏–ª–∫—É –Ω–∞ —è–∫–∏–π –≤–∏ –∫–∏–Ω—É–ª–∏\n"


                                  
                                  )






# –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —Ö–µ–Ω–¥–ª–µ—Ä–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥–∏ /privacy
@command_router.message(Command("privacy"))
async def send_privacy_policy(message: Message):
    await message.answer(f"\n"
                         f"\n"
                         f"1. –Ø–∫—ñ –¥–∞–Ω—ñ –∑–±–∏—Ä–∞—î –±–æ—Ç?\n"
                         f"–ù–∞—à –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–∏—Ä–∞—î **–ª–∏—à–µ –¥–∞–Ω—ñ, —è–∫—ñ —î –ø—É–±–ª—ñ—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ –¥–ª—è —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É Telegram**. –ó–æ–∫—Ä–µ–º–∞:\n"       
                         f"- **Telegram ID**: –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.\n"
                         f"- **–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**: –í–∞—à–µ –ø—É–±–ª—ñ—á–Ω–µ —ñ–º'—è –≤ Telegram (—è–∫—â–æ –≤–æ–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–µ).\n"
                         f"- **Username** (–Ω—ñ–∫–Ω–µ–π–º): –Ø–∫—â–æ –≤–∏ –º–∞—î—Ç–µ –ø—É–±–ª—ñ—á–Ω–∏–π username, –±–æ—Ç –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è –∑–≤–µ—Ä–Ω–µ–Ω—å –¥–æ –≤–∞—Å.\n"
                         f"- **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫—ñ –≤–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç–µ –≤ –±–æ—Ç**.\n"
                         f"\n"
                         f"–í–∞–∂–ª–∏–≤–æ:\n"
                         f"–ë–æ—Ç –ø—Ä–∞—Ü—é—î –ª–∏—à–µ –∑ —Ç–∏–º–∏ –¥–∞–Ω–∏–º–∏, —è–∫—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –±—É–¥—å-—è–∫–æ–º—É —ñ–Ω—à–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –≤ Telegram.\n"
                         f"–ë–æ—Ç **–Ω–µ –æ—Ç—Ä–∏–º—É—î –ø—Ä–∏–≤–∞—Ç–Ω—ñ –¥–∞–Ω—ñ**, —Ç–∞–∫—ñ —è–∫ –Ω–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤, –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ñ –∞–¥—Ä–µ—Å–∏ —á–∏ —ñ–Ω—à—ñ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ.\n"
                         f"–£—Å—ñ –∑—ñ–±—Ä–∞–Ω—ñ –¥–∞–Ω—ñ —î –ø—É–±–ª—ñ—á–Ω–∏–º–∏ —ñ –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ –≤ –º–µ–∂–∞—Ö —Ä–æ–±–æ—Ç–∏ Telegram.\n"
                  
                       

    
    
    
    
    
    
    
    )




# –°–ø–∏—Å–æ–∫ ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
ADMINS = [1332517469 , 6395768505] # –ó–∞–º—ñ—Å—Ç—å —Ü–∏—Ö ID –≤—Å—Ç–∞–≤—Ç–µ —Ä–µ–∞–ª—å–Ω—ñ ID –≤–∞—à–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤

@command_router.message(Command("list"))
async def command_piplist(message: Message):
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –∞–¥–º—ñ–Ω–æ–º
    if message.from_user.id in ADMINS:
        await message.answer(
            "Command - /start '–∑–∞–ø—É—Å–∫ —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞'\n"
            "\n"
            "Command - /help '–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤ –±–æ—Ç—ñ'\n"
            "\n"
            "Command - /sendall '–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–æ–∑—Å–∏–ª–∫–∏-—Ä–µ–∫–ª–∞–º–∏'\n"
            "\n"
            "Command - /piplist '–≤–∏–¥–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ —É —Å–ø–∏—Å–∫—É'\n"
            "\n"
            "Command - /clear '–æ—á–∏—â–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤'\n"
            "\n"
            "Command - /reply '–≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É —Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω–∞–º!'\n"
            "\n"
            "Command - /list '–ø–æ–¥–∏–≤–∏—Ç–∏—Å—è —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥–∏' \n"
            "\n"
            "Command - /admin '–∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è'\n"
            "\n"
            "Comm–∞nd - /add ID '–≤–∏–¥–∞—î –ø—Ä–∞–≤–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ—É–Ω–∫—Ü—ñ–π /parser'\n"
            "\n"
            "Comm–∞nd - /addoff ID '–∑–∞–±–∏—Ä–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Ñ—É–Ω–∫—Ü—ñ–π /parser'\n"
            "\n"
            "Comm–∞nd - /online '–ø–æ —Ü—ñ–π –∫–æ–º–∞–Ω–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ –±–æ—Ç—ñ'\n"
            "\n"
            "Comm–∞nd - /maintenance '–ø–æ —Ü—ñ–π –∫–æ–º–∞–Ω–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –±–æ—Ç–∞ —â–æ–±–∏ –æ–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫'\n"
            "\n"
            "Comm–∞nd - /list_users '—Ü—è –∫–æ–º–∞–Ω–¥–∞ –ø–æ–∫–∞–∑—É—î –≤–∞–º –≤—Å—é –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ª—é–¥–µ–π –≤ –±–æ—Ç—ñ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö'\n"
            "\n"
            "Comm–∞nd - /addinfo '–ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Å–µ–∞–Ω—Å–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ /parser'\n"
            "\n")
    else:
        await message.answer("–£ –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏. ‚ùå")